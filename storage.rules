rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Allow writes (uploads) only to the 'vehicle-photos' directory.
    // The path wildcard `{userId}/{fileName}` ensures that uploads are organized by user.
    match /vehicle-photos/{userId}/{fileName} {
      // Allow create (upload) operation if:
      // 1. The request is authenticated (request.auth is not null).
      // 2. The user is uploading to their own folder (request.auth.uid == userId).
      // 3. The uploaded file is an image and is less than 10MB in size.
      allow create: if request.auth != null && request.auth.uid == userId
                      && request.resource.size < 10 * 1024 * 1024
                      && request.resource.contentType.matches('image/.*');

      // Allow read (download) access to anyone.
      // This is necessary so that the images can be displayed in the app to all users.
      allow read;
    }
  }
}
